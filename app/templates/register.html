{% extends "base.html" %}

{% block title %}Register{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-5">
        <div class="card">
            <div class="card-body">
                <h3 class="card-title text-center mb-4">Register</h3>
                
                <form id="registerForm">
                    <div class="mb-3">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="full_name">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Confirm Password</label>
                        <input type="password" class="form-control" id="confirm_password" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">Register</button>
                </form>
                
                <div class="text-center mt-3">
                    <p>Already have an account? <a href="/login">Login</a></p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>

document.getElementById('registerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Get form values
    const username = document.getElementById('username').value;
    const email = document.getElementById('email').value;
    const full_name = document.getElementById('full_name').value;
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm_password').value;

    let datavalue = {
        "username": username,
        "email": email,
        "full_name": full_name,
        "password": password
    };
    
    // VALIDATIONS
    // 1. Check password length
    if (password.length < 6) {
        alert('Password must be at least 6 characters long');
        return;
    }
    
    // 2. Check if username looks like an email (optional but recommended)
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (emailPattern.test(username)) {
        const useEmail = confirm('You entered an email as username. Usernames are usually simpler (like "ajayp"). Do you want to continue with email as username?');
        if (!useEmail) {
            alert('Please choose a simpler username (not an email address)');
            document.getElementById('username').focus();
            return;
        }
    }
    
    // 3. Check if passwords match
    if (password !== confirmPassword) {
        alert('Passwords do not match!');
        return;
    }
    
    // 4. Check if username and email are different
    if (username.toLowerCase() === email.toLowerCase()) {
        alert('Username and email should be different. Please choose a different username.');
        document.getElementById('username').focus();
        return;
    }
    
    // Prepare data
    const data = {
"email": "Ajss@agilisium.com",
"username": "AjPra",
"full_name": "Ajay",
"password": "123456"
}
    
    console.log('Sending registration:', data);
    
    try {
        const response = await fetch('/api/v1/auth/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(datavalue)
            
        });
        
        if (response.ok) {
            const result = await response.json();
            alert('Registration successful! Please login.');
            window.location.href = '/login';
        } else {
            const error = await response.json();
            alert('Registration failed: ' + (error.detail || 'Please check your inputs'));
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Registration failed. Please try again.');
    }
});


</script>
{% endblock %}